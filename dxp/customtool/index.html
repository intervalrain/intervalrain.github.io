<!doctype html><html lang=zh-tw dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[DXP] 在 spotfire 中創建自定義工具 | Rain Hu's Workspace</title><meta name=keywords content="spotfire,dxp,custom tool"><meta name=description content="在 spotfire 中創建自定義工具"><meta name=author content="Rain Hu"><link rel=canonical href=https://intervalrain.github.io/><meta name=google-site-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.0cefe5a1d95e3d0f0cce057d37c60cd238d1a4af825090f831a18f21671f621d.css integrity="sha256-DO/lodlePQ8MzgV9N8YM0jjRpK+CUJD4MaGPIWcfYh0=" rel="preload stylesheet" as=style><link rel=icon href=https://intervalrain.github.io/images/rain.png><link rel=icon type=image/png sizes=16x16 href=https://intervalrain.github.io/images/rain.png><link rel=icon type=image/png sizes=32x32 href=https://intervalrain.github.io/images/rain.png><link rel=apple-touch-icon href=https://intervalrain.github.io/images/rain.png><link rel=mask-icon href=https://intervalrain.github.io/images/rain.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-tw href=https://intervalrain.github.io/dxp/customtool/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/katex.min.css integrity=sha384-zTROYFVGOfTw7JV7KUu8udsvW2fx4lWOsCEDqhBreBwlHI4ioVRtmIvEThzJHGET crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/katex.min.js integrity=sha384-GxNFqL3r9uRJQhR+47eDxuPoNE7yLftQM8LcxzgS4HT73tp970WS/wV5p8UzCOmb crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous onload=renderMathInElement(document.body)></script><script async src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script><script src=https://utteranc.es/client.js repo=intervalrain.github.io issue-term=pathname label=Comment theme=github-light crossorigin=anonymous async></script><meta property="og:url" content="https://intervalrain.github.io/dxp/customtool/"><meta property="og:site_name" content="Rain Hu's Workspace"><meta property="og:title" content="[DXP] 在 spotfire 中創建自定義工具"><meta property="og:description" content="在 spotfire 中創建自定義工具"><meta property="og:locale" content="zh-tw"><meta property="og:type" content="article"><meta property="article:section" content="dxp"><meta property="article:published_time" content="2023-06-06T22:38:08+08:00"><meta property="article:modified_time" content="2023-06-06T22:38:08+08:00"><meta property="article:tag" content="Spotfire"><meta property="article:tag" content="Dxp"><meta name=twitter:card content="summary"><meta name=twitter:title content="[DXP] 在 spotfire 中創建自定義工具"><meta name=twitter:description content="在 spotfire 中創建自定義工具"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Dxps","item":"https://intervalrain.github.io/dxp/"},{"@type":"ListItem","position":2,"name":"[DXP] 在 spotfire 中創建自定義工具","item":"https://intervalrain.github.io/dxp/customtool/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[DXP] 在 spotfire 中創建自定義工具","name":"[DXP] 在 spotfire 中創建自定義工具","description":"在 spotfire 中創建自定義工具","keywords":["spotfire","dxp","custom tool"],"articleBody":"簡介 Custom Tool 是一種通用 Spotfire 擴充類型，用於在特定文本中(spotfire app, docuemnt, visual, …)執行某些動作，且可顯示或隱藏於菜單中。 概要 開發者需新建一個類別，並繼承並實作 CustomTool 類別。然後這個類別會在 AddIn 類別的 RegisterTools 方法中註冊。此時，也可以使用CustomMenuGroup 類別指定將工具放置在自訂菜單組中。 在創建 CustomTool 類別時，工具文本被指定為類型參數，例如對於 Document 需使用使用 CustomTool，對於 Page 需使用CustomTool。 可以將提示添加到工具中。提示對話框可以添加到 Windows 客戶端和 Web 客戶端。 在實作 custom tool 時，需注意到以下的特性： Tools 是靜態的(static)：工具只有一個實例，該實例從調用 Execute() 方法的文本引數中接收其文本的處理。 Tools 是無狀態的(stateless)：一個狀態只能從一個繼承自 DocumentNode 類別並附加到文件模型的實例中保存在文件中。使用 CustomNode 類別和 Document.CustomNodes 屬性。 Tools 只執行一個動作。：通常，該動作需要在一個 undo stack 上產生一個 undo state。因此，所有更改文檔狀態的工具都應該被包裝在其 Transaction 中。 Tools 文本 1. Application public sealed class MyApplicationTool : CustomTool AnalysisApplication tools 可從「Tools」選單中取得，在啟動 Spotfire 後即可啟用。 2. Document public sealed class MyDocumentTool : CustomTool Document tools 可從「工具」選單中取得，在文件開啟時啟用。 3. Page public sealed class MyPageTool : CustomTool Page tools 可從頁面文本選單中使用，但 web client 無法使用。 4. Visual public sealed class MyVisualTool : CustomTool VisualContent 文本為頁面上的所有視覺工具提供了一個工具。還有針對特定可視化類型應用的視覺工具的子文本： Visualization: 所有可視區，不包括繪圖區(plot area)。 BarChart: 僅限長條圖。 BoxPlot: 僅限箱形圖。 CombinationChart: 僅限組合圖表。 CrossTablePlot: 僅限交叉圖表。 GraphicalTable: 僅限圖形表格繪圖。 KPIChart: 僅限KPI圖表。 LineChart: 僅限折線圖。 MapChart: 僅限地圖圖表。 ParallelCoordinatePlot PieChart: 僅限圓餅圖。 ScatterPlot: 僅限散佈圖。 ScatterPlot3D: 僅限3D散佈圖。 SummaryTable: 僅限摘要表格。 TablePlot: 僅限表格繪圖。 TextArea: 僅限文字區域。 WaterfallChart: 僅限瀑布圖表。 通過覆寫 IsVisibleCore 方法，可以將多個子文本結合起來，從而隱藏除了有明確定的子文本以外的工具。例如，擁有一個僅對散點圖和條形圖可用的工具，並在有標記(marking)時啟用。 5. TablePlot TablePlotColumn\npublic sealed class MyTablePlotColumnTool : CustomTool 當右鍵點擊列標題時，可在文本菜單中找到。 TablePlotCell\npublic sealed class MyTablePlotCellTool : CustomTool 在表格中右鍵點擊單元格時顯示的文本菜單選單中可用。 TablePlotCopyCellValue\npublic sealed class MyTablePlotCopyCellValueTool : CustomTool 在表格中右鍵點擊單元格時，可以在文本菜單的「Copy Cell」子菜單中找到。根據右鍵點擊的儲存格內容，且沒有添加任何擴展功能，子菜單標題可能包含以下一個或多個項目：\nValue: 當所點擊的儲存格包含文字時可用。文字會被放置在剪貼簿上。 Link: 當列渲染器為所點擊的儲存格提供了連結時可用。 Image: 當渲染器為單元格提供了圖像時可用。放置在剪貼板上的圖像與表格中看到的圖像相同。 TablePlotCopyCellValue 在 web client 無法使用。\n6. Map Chart Coordinates Context public sealed class MyMapChartCoordinatesTool : CustomTool 當使用者在地圖圖表上按右鍵時，具有 MapChartCoordinatesContext 的自訂工具將自動被呼叫。座標可在上下文物件的屬性中取得。 7. Filter public sealed class MyFilterTool : CustomTool FilterBase 文本使篩選器面板中的所有篩選器工具可用。還有針對特定篩選器類型應用的篩選器工具的子文本： CheckboxFilter ItemFilter ListBoxFilter RadioButtonFilter RangeFilte TextFilter HierarchyFilter ColumnFilter: 所有 filter 類型，但不包括層次篩選。 SingleValueColumnFilter: 選擇一個值的 filter 類型，即 ItemFilter 和 RadioButtonFilter. Grouping Tools、註冊 Tools 可以按它們出現的位置分類： 未指定 menu group，它將出現在「工具」菜單中。 指定 menu group，因此它將出現在「工具」選單中的自訂工具群組中。 為了防止意外或未經管理的從其他專案添加工具，只有在相同的 Spotfire 擴充專案中實現的工具才能在菜單子組中分組。通過將工具收集在一個 AddIn 中，創建該組，然後在註冊它們時將其傳遞給要包含在該組中的工具。使用 AddIn.ToolRegistrar.Register 方法註冊工具： public sealed class CustomToolAddIn : AddIn { protected override void RegisterTools(ToolRegistrar registrar) { base.RegisterTools(registrar); CustomMenuGroup menuGroup = new CustomMenuGroup(\"My menu sub group\"); registrar.Register(new MyTool(), menuGroup); } ... } 自訂頂層選單 [ApiVersion(\"10.10.0\")] public static MenuCategory CreateCustom(params string[] path); 範例：\nMenuCategory.CreateCustom(\"First\", \"Second\"); First 作為最上層的菜單標題， Second 為子菜單 或在實作 customTool 時指定 public MyTool() : base(menuText, requiredLicense, MenuCategory.CreateCustom(\"First\", \"Second\")) {} Custom Tool 建構子 CustomTool 類別的建構式有一個必要的字串參數 menuText，該字串會顯示在選單和工具提示中。可以使用 GetMenuTextCore 覆寫此文字，以獲取適應 Web Client 端本地化設置的文字。建構函式的可選參數包括運行該工具所需的許可證 requiredLicense、選單類別 menuCategory 和要顯示在選單中的自訂圖示 image。 protected CustomTool(string menuText, LicensedFunction requiredLicense, MenuCategory menuCategory, Image image) ExecuteCore 工具邏輯是透過覆寫 ExecuteCore 或 ExecuteAndPromptCore 方法來實現的，當工具需要提示使用者輸入時，後者會被使用。 protected virtual void ExecuteCore(TContext context); protected virtual IEnumerable ExecuteAndPromptCore(TContext context); 文本參數將使工具能夠訪問文件、頁面、視覺或其他對象，具體取決於工具操作的文本。 ExecuteAnPromptCore 方法的簽名需要額外解釋：注意它應該返回可枚舉物件(enumerable objects)。這是通過 yield 構造實現的，以返回用作提示模型的任何對象。使用 AddIn.RegisterViews 為工具使用的任何提示模型註冊相應的提示視圖。 如果該工具使用提示，則需要覆寫 GetSupportsPromptingCore 以返回 true。 Web Client 中的 Tools: 預期 Web Client 端中的工具支援提示，並且必須實現 ExecuteAndPromptCore (ExecuteCore 永遠不會被框架呼叫)。但是，可以使用以下解決方法在 ExecuteAndPromptCore 中實現不提示的 Web 客戶端工具，該方法調用 ExecuteCore 並返回沒有提示模型： protected override IEnumerable\u003cobject\u003e ExecuteAndPromptCore(Visualization context) { this.ExecuteCore(context); yield break; } IsEnabledCore 有兩種方法可以覆寫，以指定何時應該顯示工具，以及何時應該啟用工具。\nIsEnabledCore 回傳一個布林值，以指定該工具是否應該在選單中啟用。 protected override bool IsEnabledCore(TContext context) IsVisibleCore 回傳一個布林值，指定該工具是否應該在選單中顯示。 protected override bool IsVisibleCore(TContext context) 範例1: 將當下的頁籤移至最後。\npublic sealed class PageTool : CustomTool { public PageTool() : base(Properties.Resources.PageToolTitle) {} protected override void ExecuteCore(Page page) { Document document = page.Context.GetAncestor(); int index = document.Pages.IndexOf(page); document.Pages.Move(index, document.Pages.Count - 1); } protected override bool IsEnabledCore(Page page) { Document document = page.Context.GetAncestor(); int index = document.Pages.IndexOf(page); return index \u003e= 0 \u0026\u0026 index \u003c document.Pages.Count - 1; } } 範例2: 將 visualization 中標記的值寫出來。 public sealed class PlotTool : CustomTool { public PlotTool() : base(Properties.Resources.PlotToolTitle) {} protected override void ExecuteCore(VisualContent context) { Visualization plot = (Visualization)context; DataManager dataManager = context.Context.GetSertvice(); DataTable dataTable = plot.Data.DataTableReference; DataColumn firstColumn = dataManager.Tables[dataTable.Id].Columns[0]; IndexSet markedRows = dataManager.Markings.DefaultMarkingReference.GetSelection(dataTable).AsIndexSet(); var cursor = DataValueCursor.Create(firstColumn); foreach (var row in dataTable.GetRows(markedRows, cursor)) { Trace.WriteLine(cursor.CurrentDataValue.ValidValue); } } protected override bool IsEnabledCore(VisualContent context) { Visualization plot = context as Visualization; DataManager dataManager = context.Context.GetService(); DataMarkingSelection marking = dataManager.Markings.DefaultMarkingReference; if (plot.Data.DataReference == null) { return false; } else { RowSelection selectedRows = marking.GetSelection(plot.Data.DataTableReference); return !selectedRows.IsEmpty; } } protected override bool IsVisibleCore(VisualContent context) { return context is BarChart || context is ScatterPlot; } } 範例3: 在 Spotfire 表格中右鍵點擊顯示圖像的儲存格，選擇「複製儲存格 \u003e 圖像」，將圖像按比例縮放後添加到剪貼簿中。此範例實現了一個工具，可將全尺寸圖像複製到剪貼簿中。它可以從通用的 Spotfire 圖像複製工具相同的位置訪問： public sealed class CopyCellValueTool : CustomTool { public CopyCellValueTool() : base(\"Image (fullsize)\") {} protected override void ExecuteCore(CopyCellValueContext context) { BinaryLargeObject blob = context.DataValue.Value as BinaryLargeObject; if (blob != null) { try { Image img = Image.FromStream(blob.GetByteStream()); Clipboard.Clear(); Clipboard.SetImage(img); } catch (ArgumentException) { // Unable to convert to image, ignore } } } protected override bool IsVisibleCore(CopyCellValueContext context) { return context.DataType != null \u0026\u0026 context.ContentType != null \u0026\u0026 !context.DataType.IsSimple \u0026\u0026 context.ContentType.StartsWith(\"image/\", true, CultureInfo.InvariantCulture); } protected override bool IsEnabledCore(CopyCellValueContext context) { return context.DataValue != null \u0026\u0026 context.DataValue.IsValid; } } 範例4: 將「顯示儲存格資訊」項目添加到儲存格內容選單中。該工具會顯示一個訊息方塊，顯示所選儲存格的欄位名稱和儲存格值。\npublic sealed class TablePlotCellContextExampleTool : CustomTool { public TablePlotCellContextExampleTool() : base(Properties.Resources.TablePlotCellToolTitle) {} protected override void ExecuteCore(TablePlotCellContext tablePlotCellContext) { string dataValue = tablePlotCellContext.DataValue.Value.ToString(); string info = string.Format( System.Threading.Thread.CurrentThread.CurrentCulture, Properties.Resources.TablePlotCellToolInfo, new object[] { tablePlotCellContext.TableColumn.Name, dataValue }); System.Windows.Forms.MessageBox.Show(info, Properties.Resources.TablePlotCellToolTitle); } protected override bool IsEnabledCore(TablePlotCellContext context) { return context.DataValue != null \u0026\u0026 context.DataValue.IsValid; } } ","wordCount":"707","inLanguage":"zh-tw","datePublished":"2023-06-06T22:38:08+08:00","dateModified":"2023-06-06T22:38:08+08:00","author":{"@type":"Person","name":"Rain Hu"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://intervalrain.github.io/dxp/customtool/"},"publisher":{"@type":"Organization","name":"Rain Hu's Workspace","logo":{"@type":"ImageObject","url":"https://intervalrain.github.io/images/rain.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://intervalrain.github.io/ accesskey=h title="Rain Hu's Workspace (Alt + H)"><img src=https://intervalrain.github.io/images/rain.png alt aria-label=logo height=35>Rain Hu's Workspace</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://intervalrain.github.io/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://intervalrain.github.io/aboutme title="About me"><span>About me</span></a></li><li><a href=https://intervalrain.github.io/archives title=Archives><span>Archives</span></a></li><li><a href=https://intervalrain.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://intervalrain.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://intervalrain.github.io/csharp/csharp title=C#><span>C#</span></a></li><li><a href=https://intervalrain.github.io/csindex title=CS><span>CS</span></a></li><li><a href=https://intervalrain.github.io/leetcode title=LeetCode><span>LeetCode</span></a></li><li><a href=https://intervalrain.github.io/ai title=AI><span>AI</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://intervalrain.github.io/>首頁</a>&nbsp;»&nbsp;<a href=https://intervalrain.github.io/dxp/>Dxps</a></div><h1 class="post-title entry-hint-parent">[DXP] 在 spotfire 中創建自定義工具</h1><div class=post-description>在 spotfire 中創建自定義工具</div><div class=post-meta><span title='2023-06-06 22:38:08 +0800 +0800'>June 6, 2023</span>&nbsp;·&nbsp;4 分鐘&nbsp;·&nbsp;Rain Hu&nbsp;|&nbsp;<a href=https://github.com/intervalrain/intervalrain.github.io/tree/main/content//dxp/customTool.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目錄</span></summary><div class=inner><ul><li><a href=#%e7%b0%a1%e4%bb%8b aria-label=簡介>簡介</a></li><li><a href=#%e6%a6%82%e8%a6%81 aria-label=概要>概要</a></li><li><a href=#tools-%e6%96%87%e6%9c%ac aria-label="Tools 文本">Tools 文本</a><ul><li><a href=#1-application aria-label="1. Application">1. Application</a></li><li><a href=#2-document aria-label="2. Document">2. Document</a></li><li><a href=#3-page aria-label="3. Page">3. Page</a></li><li><a href=#4-visual aria-label="4. Visual">4. Visual</a></li><li><a href=#5-tableplot aria-label="5. TablePlot">5. TablePlot</a></li><li><a href=#6-map-chart-coordinates-context aria-label="6. Map Chart Coordinates Context">6. Map Chart Coordinates Context</a></li><li><a href=#7-filter aria-label="7. Filter">7. Filter</a></li></ul></li><li><a href=#grouping-tools%e8%a8%bb%e5%86%8a aria-label="Grouping Tools、註冊">Grouping Tools、註冊</a></li><li><a href=#custom-tool-%e5%bb%ba%e6%a7%8b%e5%ad%90 aria-label="Custom Tool 建構子">Custom Tool 建構子</a><ul><li><a href=#executecore aria-label=ExecuteCore>ExecuteCore</a></li><li><a href=#isenabledcore aria-label=IsEnabledCore>IsEnabledCore</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=簡介>簡介<a hidden class=anchor aria-hidden=true href=#簡介>#</a></h2><ul><li>Custom Tool 是一種通用 Spotfire 擴充類型，用於在特定<strong>文本</strong>中(spotfire app, docuemnt, visual, &mldr;)執行某些動作，且可顯示或隱藏於菜單中。</li></ul><hr><h2 id=概要>概要<a hidden class=anchor aria-hidden=true href=#概要>#</a></h2><ul><li>開發者需新建一個類別，並繼承並實作 <code>CustomTool</code> 類別。然後這個類別會在 <code>AddIn</code> 類別的 <code>RegisterTools</code> 方法中註冊。此時，也可以使用<code>CustomMenuGroup</code> 類別指定將工具放置在自訂菜單組中。</li><li>在創建 CustomTool 類別時，工具<strong>文本</strong>被指定為類型參數，例如對於 Document 需使用使用 <code>CustomTool&lt;Document></code>，對於 Page 需使用<code>CustomTool&lt;Page></code>。</li><li>可以將提示添加到工具中。提示對話框可以添加到 Windows 客戶端和 Web 客戶端。</li><li>在實作 custom tool 時，需注意到以下的特性：<ul><li><strong>Tools 是靜態的(static)</strong>：工具只有一個實例，該實例從調用 <code>Execute()</code> 方法的文本引數中接收其文本的處理。</li><li><strong>Tools 是無狀態的(stateless)</strong>：一個狀態只能從一個繼承自 <code>DocumentNode</code> 類別並附加到文件模型的實例中保存在文件中。使用 <code>CustomNode</code> 類別和 <code>Document.CustomNodes</code> 屬性。</li><li><strong>Tools 只執行一個動作。</strong>：通常，該動作需要在一個 undo stack 上產生一個 undo state。因此，所有更改文檔狀態的工具都應該被包裝在其 Transaction 中。</li></ul></li></ul><hr><h2 id=tools-文本>Tools 文本<a hidden class=anchor aria-hidden=true href=#tools-文本>#</a></h2><h3 id=1-application>1. Application<a hidden class=anchor aria-hidden=true href=#1-application>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyApplicationTool</span> : CustomTool&lt;AnalysisApplication&gt;
</span></span></code></pre></div><ul><li>AnalysisApplication tools 可從「<strong>Tools</strong>」選單中取得，在啟動 Spotfire 後即可啟用。</li></ul><h3 id=2-document>2. Document<a hidden class=anchor aria-hidden=true href=#2-document>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyDocumentTool</span> : CustomTool&lt;Document&gt;
</span></span></code></pre></div><ul><li>Document tools 可從「<strong>工具</strong>」選單中取得，在文件開啟時啟用。</li></ul><h3 id=3-page>3. Page<a hidden class=anchor aria-hidden=true href=#3-page>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyPageTool</span> : CustomTool&lt;Page&gt;
</span></span></code></pre></div><ul><li>Page tools 可從頁面文本選單中使用，但 web client 無法使用。</li></ul><h3 id=4-visual>4. Visual<a hidden class=anchor aria-hidden=true href=#4-visual>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyVisualTool</span> : CustomTool&lt;VisualContent&gt;
</span></span></code></pre></div><ul><li>VisualContent 文本為頁面上的所有視覺工具提供了一個工具。還有針對特定可視化類型應用的視覺工具的子文本：<ul><li>Visualization: 所有可視區，不包括繪圖區(plot area)。</li><li>BarChart: 僅限長條圖。</li><li>BoxPlot: 僅限箱形圖。</li><li>CombinationChart: 僅限組合圖表。</li><li>CrossTablePlot: 僅限交叉圖表。</li><li>GraphicalTable: 僅限圖形表格繪圖。</li><li>KPIChart: 僅限KPI圖表。</li><li>LineChart: 僅限折線圖。</li><li>MapChart: 僅限地圖圖表。</li><li>ParallelCoordinatePlot</li><li>PieChart: 僅限圓餅圖。</li><li>ScatterPlot: 僅限散佈圖。</li><li>ScatterPlot3D: 僅限3D散佈圖。</li><li>SummaryTable: 僅限摘要表格。</li><li>TablePlot: 僅限表格繪圖。</li><li>TextArea: 僅限文字區域。</li><li>WaterfallChart: 僅限瀑布圖表。</li></ul></li><li>通過覆寫 <code>IsVisibleCore</code> 方法，可以將多個子文本結合起來，從而隱藏除了有明確定的子文本以外的工具。例如，擁有一個僅對散點圖和條形圖可用的工具，並在有標記(marking)時啟用。</li></ul><h3 id=5-tableplot>5. TablePlot<a hidden class=anchor aria-hidden=true href=#5-tableplot>#</a></h3><p>TablePlotColumn</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyTablePlotColumnTool</span> : CustomTool&lt;TablePlotColumnContext&gt;
</span></span></code></pre></div><ul><li>當右鍵點擊列標題時，可在文本菜單中找到。</li></ul><hr><p>TablePlotCell</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyTablePlotCellTool</span> : CustomTool&lt;TablePlotCellContext&gt;
</span></span></code></pre></div><ul><li>在表格中右鍵點擊單元格時顯示的文本菜單選單中可用。</li></ul><hr><p>TablePlotCopyCellValue</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyTablePlotCopyCellValueTool</span> : CustomTool&lt;TablePlotCopyCellValueContext&gt;
</span></span></code></pre></div><ul><li><p>在表格中右鍵點擊單元格時，可以在文本菜單的「Copy Cell」子菜單中找到。根據右鍵點擊的儲存格內容，且沒有添加任何擴展功能，子菜單標題可能包含以下一個或多個項目：</p><ul><li>Value: 當所點擊的儲存格包含文字時可用。文字會被放置在剪貼簿上。</li><li>Link: 當列渲染器為所點擊的儲存格提供了連結時可用。</li><li>Image: 當渲染器為單元格提供了圖像時可用。放置在剪貼板上的圖像與表格中看到的圖像相同。</li></ul></li><li><p>TablePlotCopyCellValue 在 web client 無法使用。</p></li></ul><h3 id=6-map-chart-coordinates-context>6. Map Chart Coordinates Context<a hidden class=anchor aria-hidden=true href=#6-map-chart-coordinates-context>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyMapChartCoordinatesTool</span> : CustomTool&lt;MapChartCoordinatesContext&gt;
</span></span></code></pre></div><ul><li>當使用者在地圖圖表上按右鍵時，具有 MapChartCoordinatesContext 的自訂工具將自動被呼叫。座標可在上下文物件的屬性中取得。</li></ul><h3 id=7-filter>7. Filter<a hidden class=anchor aria-hidden=true href=#7-filter>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyFilterTool</span> : CustomTool&lt;FilterBase&gt;
</span></span></code></pre></div><ul><li>FilterBase 文本使篩選器面板中的所有篩選器工具可用。還有針對特定篩選器類型應用的篩選器工具的子文本：<ul><li>CheckboxFilter</li><li>ItemFilter</li><li>ListBoxFilter</li><li>RadioButtonFilter</li><li>RangeFilte</li><li>TextFilter</li><li>HierarchyFilter</li><li>ColumnFilter: 所有 filter 類型，但不包括層次篩選。</li><li>SingleValueColumnFilter: 選擇一個值的 filter 類型，即 ItemFilter 和 RadioButtonFilter.</li></ul></li></ul><h2 id=grouping-tools註冊>Grouping Tools、註冊<a hidden class=anchor aria-hidden=true href=#grouping-tools註冊>#</a></h2><ul><li>Tools 可以按它們出現的位置分類：<ul><li>未指定 menu group，它將出現在「工具」菜單中。</li><li>指定 menu group，因此它將出現在「工具」選單中的自訂工具群組中。</li></ul></li><li>為了防止意外或未經管理的從其他專案添加工具，只有在相同的 Spotfire 擴充專案中實現的工具才能在菜單子組中分組。通過將工具收集在一個 <code>AddIn</code> 中，創建該組，然後在註冊它們時將其傳遞給要包含在該組中的工具。使用 <code>AddIn.ToolRegistrar.Register</code> 方法註冊工具：</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CustomToolAddIn</span> : AddIn
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>void</span> RegisterTools(ToolRegistrar registrar)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>base</span>.RegisterTools(registrar);
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        CustomMenuGroup menuGroup = <span style=color:#66d9ef>new</span> CustomMenuGroup(<span style=color:#e6db74>&#34;My menu sub group&#34;</span>);
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        registrar.Register(<span style=color:#66d9ef>new</span> MyTool(), menuGroup);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>自訂頂層選單
<img alt=pic2 loading=lazy src="https://community.tibco.com/servlet/rtaImage?eid=ka54z0000004XLz&feoid=00N4z000003259m&refid=0EM4z000003V2dI"></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#a6e22e>[ApiVersion(&#34;10.10.0&#34;)]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> MenuCategory CreateCustom(<span style=color:#66d9ef>params</span> <span style=color:#66d9ef>string</span>[] path);
</span></span></code></pre></div><p>範例：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span>MenuCategory.CreateCustom(<span style=color:#e6db74>&#34;First&#34;</span>, <span style=color:#e6db74>&#34;Second&#34;</span>);
</span></span></code></pre></div><ul><li>First 作為最上層的菜單標題， Second 為子菜單
或在實作 customTool 時指定</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>public</span> MyTool()
</span></span><span style=display:flex><span>    : <span style=color:#66d9ef>base</span>(menuText, requiredLicense, MenuCategory.CreateCustom(<span style=color:#e6db74>&#34;First&#34;</span>, <span style=color:#e6db74>&#34;Second&#34;</span>)) {}
</span></span></code></pre></div><hr><h2 id=custom-tool-建構子>Custom Tool 建構子<a hidden class=anchor aria-hidden=true href=#custom-tool-建構子>#</a></h2><ul><li>CustomTool 類別的建構式有一個必要的字串參數 <code>menuText</code>，該字串會顯示在選單和工具提示中。可以使用 <code>GetMenuTextCore</code> 覆寫此文字，以獲取適應 Web Client 端本地化設置的文字。建構函式的可選參數包括運行該工具所需的許可證 <code>requiredLicense</code>、選單類別 <code>menuCategory</code> 和要顯示在選單中的自訂圖示 <code>image</code>。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>protected</span> CustomTool(<span style=color:#66d9ef>string</span> menuText, LicensedFunction requiredLicense, MenuCategory menuCategory, Image image)
</span></span></code></pre></div><h3 id=executecore>ExecuteCore<a hidden class=anchor aria-hidden=true href=#executecore>#</a></h3><ul><li>工具邏輯是透過覆寫 <code>ExecuteCore</code> 或 <code>ExecuteAndPromptCore</code> 方法來實現的，當工具需要提示使用者輸入時，後者會被使用。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>virtual</span> <span style=color:#66d9ef>void</span> ExecuteCore(TContext context);
</span></span><span style=display:flex><span><span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>virtual</span> IEnumerable&lt;Object&gt; ExecuteAndPromptCore(TContext context);
</span></span></code></pre></div><ul><li>文本參數將使工具能夠訪問文件、頁面、視覺或其他對象，具體取決於工具操作的文本。</li><li><code>ExecuteAnPromptCore</code> 方法的簽名需要額外解釋：注意它應該返回可枚舉物件(enumerable objects)。這是通過 yield 構造實現的，以返回用作提示模型的任何對象。使用 <code>AddIn.RegisterViews</code> 為工具使用的任何提示模型註冊相應的提示視圖。</li><li>如果該工具使用提示，則需要覆寫 <code>GetSupportsPromptingCore</code> 以返回 <code>true</code>。</li><li>Web Client 中的 Tools:<ul><li>預期 Web Client 端中的工具支援提示，並且必須實現 <code>ExecuteAndPromptCore</code> (<code>ExecuteCore</code> 永遠不會被框架呼叫)。但是，可以使用以下解決方法在 <code>ExecuteAndPromptCore</code> 中實現不提示的 Web 客戶端工具，該方法調用 <code>ExecuteCore</code> 並返回沒有提示模型：</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>override</span> IEnumerable&lt;<span style=color:#66d9ef>object</span>&gt; ExecuteAndPromptCore(Visualization context)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.ExecuteCore(context);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>yield</span> <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li></ul><h3 id=isenabledcore>IsEnabledCore<a hidden class=anchor aria-hidden=true href=#isenabledcore>#</a></h3><ul><li><p>有兩種方法可以覆寫，以指定何時應該顯示工具，以及何時應該啟用工具。</p><ul><li><code>IsEnabledCore</code> 回傳一個布林值，以指定該工具是否應該在選單中啟用。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>bool</span> IsEnabledCore(TContext context)
</span></span></code></pre></div><ul><li><code>IsVisibleCore</code> 回傳一個布林值，指定該工具是否應該在選單中顯示。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>bool</span> IsVisibleCore(TContext context)
</span></span></code></pre></div></li><li><p>範例1: 將當下的頁籤移至最後。</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PageTool</span> : CustomTool&lt;Page&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> PageTool()
</span></span><span style=display:flex><span>        : <span style=color:#66d9ef>base</span>(Properties.Resources.PageToolTitle) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>void</span> ExecuteCore(Page page)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        Document document = page.Context.GetAncestor&lt;Document&gt;();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> index = document.Pages.IndexOf(page);
</span></span><span style=display:flex><span>        document.Pages.Move(index, document.Pages.Count - <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>bool</span> IsEnabledCore(Page page)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        Document document = page.Context.GetAncestor&lt;Document&gt;();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> index = document.Pages.IndexOf(page);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> index &gt;= <span style=color:#ae81ff>0</span> &amp;&amp; index &lt; document.Pages.Count - <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>範例2: 將 visualization 中標記的值寫出來。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PlotTool</span> : CustomTool&lt;VisualContent&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> PlotTool()
</span></span><span style=display:flex><span>        : <span style=color:#66d9ef>base</span>(Properties.Resources.PlotToolTitle) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>void</span> ExecuteCore(VisualContent context)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        Visualization plot = (Visualization)context;
</span></span><span style=display:flex><span>        DataManager dataManager = context.Context.GetSertvice&lt;DataManager&gt;();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        DataTable dataTable = plot.Data.DataTableReference;
</span></span><span style=display:flex><span>        DataColumn firstColumn = dataManager.Tables[dataTable.Id].Columns[<span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        IndexSet markedRows = dataManager.Markings.DefaultMarkingReference.GetSelection(dataTable).AsIndexSet();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> cursor = DataValueCursor.Create(firstColumn);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>foreach</span> (<span style=color:#66d9ef>var</span> row <span style=color:#66d9ef>in</span> dataTable.GetRows(markedRows, cursor))
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            Trace.WriteLine(cursor.CurrentDataValue.ValidValue);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>bool</span> IsEnabledCore(VisualContent context)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        Visualization plot = context <span style=color:#66d9ef>as</span> Visualization;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        DataManager dataManager = context.Context.GetService&lt;DataManager&gt;();
</span></span><span style=display:flex><span>        DataMarkingSelection marking = dataManager.Markings.DefaultMarkingReference;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (plot.Data.DataReference == <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            RowSelection selectedRows = marking.GetSelection(plot.Data.DataTableReference);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> !selectedRows.IsEmpty;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>bool</span> IsVisibleCore(VisualContent context)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> context <span style=color:#66d9ef>is</span> BarChart || context <span style=color:#66d9ef>is</span> ScatterPlot;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>範例3: 在 Spotfire 表格中右鍵點擊顯示圖像的儲存格，選擇「複製儲存格 > 圖像」，將圖像按比例縮放後添加到剪貼簿中。此範例實現了一個工具，可將全尺寸圖像複製到剪貼簿中。它可以從通用的 Spotfire 圖像複製工具相同的位置訪問：
<img alt=pic4 loading=lazy src="https://community.tibco.com/servlet/rtaImage?eid=ka54z0000004Zgk&feoid=00N4z000003259m&refid=0EM4z000003V3di"></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CopyCellValueTool</span> : CustomTool&lt;CopyCellValueContext&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> CopyCellValueTool() : <span style=color:#66d9ef>base</span>(<span style=color:#e6db74>&#34;Image (fullsize)&#34;</span>) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>void</span> ExecuteCore(CopyCellValueContext context)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        BinaryLargeObject blob = context.DataValue.Value <span style=color:#66d9ef>as</span> BinaryLargeObject;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (blob != <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                Image img = Image.FromStream(blob.GetByteStream());
</span></span><span style=display:flex><span>                Clipboard.Clear();
</span></span><span style=display:flex><span>                Clipboard.SetImage(img);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>catch</span> (ArgumentException)
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Unable to convert to image, ignore</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>bool</span> IsVisibleCore(CopyCellValueContext context)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> context.DataType != <span style=color:#66d9ef>null</span> &amp;&amp;
</span></span><span style=display:flex><span>            context.ContentType != <span style=color:#66d9ef>null</span> &amp;&amp;
</span></span><span style=display:flex><span>            !context.DataType.IsSimple &amp;&amp;
</span></span><span style=display:flex><span>            context.ContentType.StartsWith(<span style=color:#e6db74>&#34;image/&#34;</span>, <span style=color:#66d9ef>true</span>, CultureInfo.InvariantCulture);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>bool</span> IsEnabledCore(CopyCellValueContext context)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> context.DataValue != <span style=color:#66d9ef>null</span> &amp;&amp; context.DataValue.IsValid;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>範例4: 將「顯示儲存格資訊」項目添加到儲存格內容選單中。該工具會顯示一個訊息方塊，顯示所選儲存格的欄位名稱和儲存格值。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TablePlotCellContextExampleTool</span> : CustomTool&lt;TablePlotCellContext&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> TablePlotCellContextExampleTool() : <span style=color:#66d9ef>base</span>(Properties.Resources.TablePlotCellToolTitle) {}
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>void</span> ExecuteCore(TablePlotCellContext tablePlotCellContext)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>string</span> dataValue = tablePlotCellContext.DataValue.Value.ToString();
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>string</span> info = <span style=color:#66d9ef>string</span>.Format(
</span></span><span style=display:flex><span>            System.Threading.Thread.CurrentThread.CurrentCulture,
</span></span><span style=display:flex><span>            Properties.Resources.TablePlotCellToolInfo,
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>object</span>[] { tablePlotCellContext.TableColumn.Name,
</span></span><span style=display:flex><span>                           dataValue });
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        System.Windows.Forms.MessageBox.Show(info, Properties.Resources.TablePlotCellToolTitle);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>bool</span> IsEnabledCore(TablePlotCellContext context)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> context.DataValue != <span style=color:#66d9ef>null</span> &amp;&amp; context.DataValue.IsValid;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://intervalrain.github.io/tags/spotfire/>Spotfire</a></li><li><a href=https://intervalrain.github.io/tags/dxp/>Dxp</a></li></ul><script type=module>  
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; 
    mermaid.initialize({ startOnLoad: true });  
</script><script>Array.from(document.getElementsByClassName("language-mermaid")).forEach(e=>{e.parentElement.outerHTML=`<div class="mermaid">${e.innerHTML}</div>`})</script><style>.mermaid svg{display:block;margin:auto}</style></footer><script src=https://utteranc.es/client.js repo=Reid00/hugo-blog-talks issue-term=pathname label=Comment theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2025 <a href=https://intervalrain.github.io/>Rain Hu's Workspace</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="複製";function s(){t.innerHTML="已複製！",setTimeout(()=>{t.innerHTML="複製"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>