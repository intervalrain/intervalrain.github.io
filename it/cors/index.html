<!doctype html><html lang=zh-tw dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[IT] CORS 跨原始來源要求 | Rain Hu's Workspace</title><meta name=keywords content="IT,C#"><meta name=description content="TL;DR

CORS (Cross-Origin Resource Sharing)
是一個支援安全跨源請求和資料傳輸的機制，用於在瀏覽器和伺服器之間進行跨源請求。

這是一個 W3C 標準，可讓伺服器放寬相同原始來源原則。
不是安全性功能，CORS 會放寬安全性。 允許 CORS 並不會增強 API 的安全性。CORS 的運作方式
允許伺服器明確允許某些跨原始來源要求，同時拒絕其他要求。
比舊版技術 (例如：JSONP) 更安全且更有彈性。

何謂相同原始來源

如果兩個 URL 具有相同的配置、主機和連接埠，則其原始來源相同 (RFC 6454)。

這兩個 URL 具有相同的原始來源：

https://example.com/foo.html
https://example.com/bar.html


這些 URL 的原始來源與前兩個 URL 不同：

https://example.net：不同的網域
https://www.example.com/foo.html：不同的子網域
http://example.com/foo.html：不同的配置
https://example.com:9000/foo.html：不同的連接埠





如何啟動 CORS
有三種方式可以啟用 CORS：

在中介軟體中，使用具名原則或預設原則。
使用端點路由。
使用 [EnableCors] 屬性。
搭配具名原則使用 [EnableCors] 屬性能夠以最精細的程度來控制對於支援 CORS 之端點的限制。



"><meta name=author content="Rain Hu"><link rel=canonical href=https://intervalrain.github.io/><meta name=google-site-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.4c6c0beaf1dfe52cd0f712a5896ac127e66fd064cfc598e04750f496d470699e.css integrity="sha256-TGwL6vHf5SzQ9xKliWrBJ+Zv0GTPxZjgR1D0ltRwaZ4=" rel="preload stylesheet" as=style><link rel=icon href=https://intervalrain.github.io/images/rain.png><link rel=icon type=image/png sizes=16x16 href=https://intervalrain.github.io/images/rain.png><link rel=icon type=image/png sizes=32x32 href=https://intervalrain.github.io/images/rain.png><link rel=apple-touch-icon href=https://intervalrain.github.io/images/rain.png><link rel=mask-icon href=https://intervalrain.github.io/images/rain.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-tw href=https://intervalrain.github.io/it/cors/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/katex.min.css integrity=sha384-zTROYFVGOfTw7JV7KUu8udsvW2fx4lWOsCEDqhBreBwlHI4ioVRtmIvEThzJHGET crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/katex.min.js integrity=sha384-GxNFqL3r9uRJQhR+47eDxuPoNE7yLftQM8LcxzgS4HT73tp970WS/wV5p8UzCOmb crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous onload=renderMathInElement(document.body)></script><script async src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script><script src=https://utteranc.es/client.js repo=intervalrain.github.io issue-term=pathname label=Comment theme=github-light crossorigin=anonymous async></script><meta property="og:url" content="https://intervalrain.github.io/it/cors/"><meta property="og:site_name" content="Rain Hu's Workspace"><meta property="og:title" content="[IT] CORS 跨原始來源要求"><meta property="og:description" content="TL;DR CORS (Cross-Origin Resource Sharing)
是一個支援安全跨源請求和資料傳輸的機制，用於在瀏覽器和伺服器之間進行跨源請求。
這是一個 W3C 標準，可讓伺服器放寬相同原始來源原則。 不是安全性功能，CORS 會放寬安全性。 允許 CORS 並不會增強 API 的安全性。CORS 的運作方式 允許伺服器明確允許某些跨原始來源要求，同時拒絕其他要求。 比舊版技術 (例如：JSONP) 更安全且更有彈性。 何謂相同原始來源 如果兩個 URL 具有相同的配置、主機和連接埠，則其原始來源相同 (RFC 6454)。 這兩個 URL 具有相同的原始來源： https://example.com/foo.html https://example.com/bar.html 這些 URL 的原始來源與前兩個 URL 不同： https://example.net：不同的網域 https://www.example.com/foo.html：不同的子網域 http://example.com/foo.html：不同的配置 https://example.com:9000/foo.html：不同的連接埠 如何啟動 CORS 有三種方式可以啟用 CORS：
在中介軟體中，使用具名原則或預設原則。 使用端點路由。 使用 [EnableCors] 屬性。 搭配具名原則使用 [EnableCors] 屬性能夠以最精細的程度來控制對於支援 CORS 之端點的限制。 "><meta property="og:locale" content="zh-tw"><meta property="og:type" content="article"><meta property="article:section" content="it"><meta property="article:published_time" content="2024-01-19T00:41:51+08:00"><meta property="article:modified_time" content="2024-01-19T00:41:51+08:00"><meta property="article:tag" content="IT"><meta property="article:tag" content="C#"><meta name=twitter:card content="summary"><meta name=twitter:title content="[IT] CORS 跨原始來源要求"><meta name=twitter:description content="TL;DR

CORS (Cross-Origin Resource Sharing)
是一個支援安全跨源請求和資料傳輸的機制，用於在瀏覽器和伺服器之間進行跨源請求。

這是一個 W3C 標準，可讓伺服器放寬相同原始來源原則。
不是安全性功能，CORS 會放寬安全性。 允許 CORS 並不會增強 API 的安全性。CORS 的運作方式
允許伺服器明確允許某些跨原始來源要求，同時拒絕其他要求。
比舊版技術 (例如：JSONP) 更安全且更有彈性。

何謂相同原始來源

如果兩個 URL 具有相同的配置、主機和連接埠，則其原始來源相同 (RFC 6454)。

這兩個 URL 具有相同的原始來源：

https://example.com/foo.html
https://example.com/bar.html


這些 URL 的原始來源與前兩個 URL 不同：

https://example.net：不同的網域
https://www.example.com/foo.html：不同的子網域
http://example.com/foo.html：不同的配置
https://example.com:9000/foo.html：不同的連接埠





如何啟動 CORS
有三種方式可以啟用 CORS：

在中介軟體中，使用具名原則或預設原則。
使用端點路由。
使用 [EnableCors] 屬性。
搭配具名原則使用 [EnableCors] 屬性能夠以最精細的程度來控制對於支援 CORS 之端點的限制。



"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"ITs","item":"https://intervalrain.github.io/it/"},{"@type":"ListItem","position":2,"name":"[IT] CORS 跨原始來源要求","item":"https://intervalrain.github.io/it/cors/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[IT] CORS 跨原始來源要求","name":"[IT] CORS 跨原始來源要求","description":"TL;DR CORS (Cross-Origin Resource Sharing)\n是一個支援安全跨源請求和資料傳輸的機制，用於在瀏覽器和伺服器之間進行跨源請求。\n這是一個 W3C 標準，可讓伺服器放寬相同原始來源原則。 不是安全性功能，CORS 會放寬安全性。 允許 CORS 並不會增強 API 的安全性。CORS 的運作方式 允許伺服器明確允許某些跨原始來源要求，同時拒絕其他要求。 比舊版技術 (例如：JSONP) 更安全且更有彈性。 何謂相同原始來源 如果兩個 URL 具有相同的配置、主機和連接埠，則其原始來源相同 (RFC 6454)。 這兩個 URL 具有相同的原始來源： https://example.com/foo.html https://example.com/bar.html 這些 URL 的原始來源與前兩個 URL 不同： https://example.net：不同的網域 https://www.example.com/foo.html：不同的子網域 http://example.com/foo.html：不同的配置 https://example.com:9000/foo.html：不同的連接埠 如何啟動 CORS 有三種方式可以啟用 CORS：\n在中介軟體中，使用具名原則或預設原則。 使用端點路由。 使用 [EnableCors] 屬性。 搭配具名原則使用 [EnableCors] 屬性能夠以最精細的程度來控制對於支援 CORS 之端點的限制。 ","keywords":["IT","C#"],"articleBody":"TL;DR CORS (Cross-Origin Resource Sharing)\n是一個支援安全跨源請求和資料傳輸的機制，用於在瀏覽器和伺服器之間進行跨源請求。\n這是一個 W3C 標準，可讓伺服器放寬相同原始來源原則。 不是安全性功能，CORS 會放寬安全性。 允許 CORS 並不會增強 API 的安全性。CORS 的運作方式 允許伺服器明確允許某些跨原始來源要求，同時拒絕其他要求。 比舊版技術 (例如：JSONP) 更安全且更有彈性。 何謂相同原始來源 如果兩個 URL 具有相同的配置、主機和連接埠，則其原始來源相同 (RFC 6454)。 這兩個 URL 具有相同的原始來源： https://example.com/foo.html https://example.com/bar.html 這些 URL 的原始來源與前兩個 URL 不同： https://example.net：不同的網域 https://www.example.com/foo.html：不同的子網域 http://example.com/foo.html：不同的配置 https://example.com:9000/foo.html：不同的連接埠 如何啟動 CORS 有三種方式可以啟用 CORS：\n在中介軟體中，使用具名原則或預設原則。 使用端點路由。 使用 [EnableCors] 屬性。 搭配具名原則使用 [EnableCors] 屬性能夠以最精細的程度來控制對於支援 CORS 之端點的限制。 必須以正確的順序呼叫 UseCors。例如，在使用 UseResponseCaching 時，必須先呼叫 UseCors，再呼叫 UseResponseCaching。\n具有具名原則和中介軟體的 CORS var MyAllowSpecificOrigins = \"_myAllowSpecificOrigins\"; var builder = WebApplication.CreateBuilder(args); builder.Services.AddCors(options =\u003e { options.AddPolicy(name: MyAllowSpecificOrigins, policy =\u003e { policy.WithOrigins(\"http://example.com\", \"http://www.contoso.com\"); // policy.WithOrigins(\"http://example.com\", \"http://www.contoso.com\") // .AllowAnyHeader() // .AllowAnyMethod(); ### policyBuilder 可以鏈結 ### }); }); // services.AddResponseCaching(); builder.Services.AddControllers(); var app = builder.Build(); app.UseHttpsRedirection(); app.UseStaticFiles(); app.UseRouting(); app.UseCors(MyAllowSpecificOrigins); app.UseAuthorization(); app.MapControllers(); app.Run(); 上述 程式碼：\n將原則名稱設定為 _myAllowSpecificOrigins。原則名稱可以為任意值。 呼叫 UseCors 擴充方法，並指定 _myAllowSpecificOrigins CORS 原則。UseCors 會新增 CORS 中介軟體。對 UseCors 的呼叫必須放在 UseRouting 之後、UseAuthorization 之前。 使用 Lambda 運算式呼叫 AddCors。 Lambda 會採用 CorsPolicyBuilder 物件。本文稍後會說明組態選項，例如：WithOrigins。 為所有控制器端點啟用 _myAllowSpecificOrigins CORS 原則。 使回應快取中介軟體時，請先呼叫 UseCors，再呼叫 UseResponseCaching。 使用端點路由時，CORS 中介軟體必須設定為在呼叫 UseRouting 和 UseEndpoints 之間執行。\nAddCors 方法呼叫會將 CORS 服務新增至應用程式的服務容器：\n注意：指定的 URL 不得包含尾端斜線 (/)。 如果 URL 以 / 終止，則比較會傳回 false，而且不會傳回任何標頭。\nUseCors 和 UseStaticFiles 順序 一般而言，會先呼叫 UseStaticFiles，再呼叫 UseCors。 使用 JavaScript 來擷取跨網站靜態檔案的應用程式必須先呼叫 UseCors，再呼叫 UseStaticFiles。 具有預設原則和中介軟體的 CORS var builder = WebApplication.CreateBuilder(args); builder.Services.AddCors(options =\u003e { options.AddDefaultPolicy( policy =\u003e { policy.WithOrigins(\"http://example.com\", \"http://www.contoso.com\"); }); }); builder.Services.AddControllers(); var app = builder.Build(); app.UseHttpsRedirection(); app.UseStaticFiles(); app.UseRouting(); app.UseCors(); app.UseAuthorization(); app.MapControllers(); app.Run(); 上述程式碼會將預設 CORS 原則套用至所有控制器端點。\n使用端點路由啟用 CORS 使用端點路由時，可以使用一組 RequiredCors 擴充方法，逐個端點啟用 CORS：\nvar MyAllowSpecificOrigins = \"_myAllowSpecificOrigins\"; var builder = WebApplication.CreateBuilder(args); builder.Services.AddCors(options =\u003e { options.AddPolicy(name: MyAllowSpecificOrigins, policy =\u003e { policy.WithOrigins(\"http://example.com\", \"http://www.contoso.com\"); }); }); builder.Services.AddControllers(); builder.Services.AddRazorPages(); var app = builder.Build(); app.UseHttpsRedirection(); app.UseStaticFiles(); app.UseRouting(); app.UseCors(); app.UseAuthorization(); app.UseEndpoints(endpoints =\u003e { endpoints.MapGet(\"/echo\", context =\u003e context.Response.WriteAsync(\"echo\")) .RequireCors(MyAllowSpecificOrigins); endpoints.MapControllers() .RequireCors(MyAllowSpecificOrigins); endpoints.MapGet(\"/echo2\", context =\u003e context.Response.WriteAsync(\"echo2\")); endpoints.MapRazorPages(); }); app.Run(); 在上述程式碼中：\napp.UseCors 會啟用 CORS 中介軟體。 因為尚未設定預設原則，因此單獨的 app.UseCors() 不會啟用 CORS。 /echo 和控制器端點允許使用指定的原則進行跨原始來源要求。 /echo2 和 Razor Pages 端點不允許跨原始來源要求，因為未指定預設原則。 如果 CORS 是由端點路由透過 RequireCors 所啟用的，則 [DisableCors] 屬性無法停用 CORS。 使用屬性啟用 CORS 使用[EnableCors]屬性啟用 CORS，並將具名原則套用至只需要 CORS 的端點，這樣才能提供最精細的控制。 [EnableCors] 屬性提供全域套用 CORS 的替代方案。[EnableCors] 屬性會啟用所選端點的 CORS，而不是所有端點：\n[EnableCors] 指定預設原則。 [EnableCors(\"{Policy String}\")] 指定具名原則。 [EnableCors] 屬性可以套用至：\nRazor Page PageModel 控制器 控制器動作方法 透過 [EnableCors] 屬性，可以將不同的原則套用至控制器、頁面模型或動作方法。 當 [EnableCors] 屬性套用至控制器、頁面模型或動作方法，並在中介軟體中啟用 CORS 時，兩個原則都會被套用。 不建議進行原則合併。 使用 [EnableCors] 屬性或中介軟體，而不是在同一個應用程式中。 下列程式碼會將不同的原則套用至每個方法：\n[Route(\"api/[controller]\")] [ApiController] public class WidgetController : ControllerBase { // GET api/values [EnableCors(\"AnotherPolicy\")] [HttpGet] public ActionResult","wordCount":"542","inLanguage":"zh-tw","datePublished":"2024-01-19T00:41:51+08:00","dateModified":"2024-01-19T00:41:51+08:00","author":{"@type":"Person","name":"Rain Hu"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://intervalrain.github.io/it/cors/"},"publisher":{"@type":"Organization","name":"Rain Hu's Workspace","logo":{"@type":"ImageObject","url":"https://intervalrain.github.io/images/rain.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://intervalrain.github.io/ accesskey=h title="Rain Hu's Workspace (Alt + H)"><img src=https://intervalrain.github.io/images/rain.png alt aria-label=logo height=35>Rain Hu's Workspace</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://intervalrain.github.io/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://intervalrain.github.io/aboutme title="About me"><span>About me</span></a></li><li><a href=https://intervalrain.github.io/archives title=Archives><span>Archives</span></a></li><li><a href=https://intervalrain.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://intervalrain.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://intervalrain.github.io/csharp/csharp title=C#><span>C#</span></a></li><li><a href=https://intervalrain.github.io/csindex title=CS><span>CS</span></a></li><li><a href=https://intervalrain.github.io/leetcode title=LeetCode><span>LeetCode</span></a></li><li><a href=https://intervalrain.github.io/ai title=AI><span>AI</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://intervalrain.github.io/>首頁</a>&nbsp;»&nbsp;<a href=https://intervalrain.github.io/it/>ITs</a></div><h1 class="post-title entry-hint-parent">[IT] CORS 跨原始來源要求</h1><div class=post-meta><span title='2024-01-19 00:41:51 +0800 +0800'>January 19, 2024</span>&nbsp;·&nbsp;3 分鐘&nbsp;·&nbsp;Rain Hu&nbsp;|&nbsp;<a href=https://github.com/intervalrain/intervalrain.github.io/tree/main/content//IT/CORS.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目錄</span></summary><div class=inner><ul><li><a href=#tldr aria-label=TL;DR>TL;DR</a></li><li><a href=#%e4%bd%95%e8%ac%82%e7%9b%b8%e5%90%8c%e5%8e%9f%e5%a7%8b%e4%be%86%e6%ba%90 aria-label=何謂相同原始來源>何謂相同原始來源</a></li><li><a href=#%e5%a6%82%e4%bd%95%e5%95%9f%e5%8b%95-cors aria-label="如何啟動 CORS">如何啟動 CORS</a><ul><li><a href=#%e5%85%b7%e6%9c%89%e5%85%b7%e5%90%8d%e5%8e%9f%e5%89%87%e5%92%8c%e4%b8%ad%e4%bb%8b%e8%bb%9f%e9%ab%94%e7%9a%84-cors aria-label="具有具名原則和中介軟體的 CORS">具有具名原則和中介軟體的 CORS</a></li><li><a href=#%e5%85%b7%e6%9c%89%e9%a0%90%e8%a8%ad%e5%8e%9f%e5%89%87%e5%92%8c%e4%b8%ad%e4%bb%8b%e8%bb%9f%e9%ab%94%e7%9a%84-cors aria-label="具有預設原則和中介軟體的 CORS">具有預設原則和中介軟體的 CORS</a></li><li><a href=#%e4%bd%bf%e7%94%a8%e7%ab%af%e9%bb%9e%e8%b7%af%e7%94%b1%e5%95%9f%e7%94%a8-cors aria-label="使用端點路由啟用 CORS">使用端點路由啟用 CORS</a></li><li><a href=#%e4%bd%bf%e7%94%a8%e5%b1%ac%e6%80%a7%e5%95%9f%e7%94%a8-cors aria-label="使用屬性啟用 CORS">使用屬性啟用 CORS</a></li></ul></li><li><a href=#%e5%81%9c%e7%94%a8-cors aria-label="停用 CORS">停用 CORS</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=tldr>TL;DR<a hidden class=anchor aria-hidden=true href=#tldr>#</a></h2><blockquote><p>CORS (Cross-Origin Resource Sharing)<br>是一個支援安全跨源請求和資料傳輸的機制，用於在瀏覽器和伺服器之間進行跨源請求。</p></blockquote><ul><li>這是一個 W3C 標準，可讓伺服器放寬相同原始來源原則。</li><li>不是安全性功能，CORS 會放寬安全性。 允許 CORS 並不會增強 API 的安全性。<a href="https://learn.microsoft.com/zh-tw/aspnet/core/security/cors?view=aspnetcore-8.0#how-cors">CORS 的運作方式</a></li><li>允許伺服器明確允許某些跨原始來源要求，同時拒絕其他要求。</li><li>比舊版技術 (例如：<a href=https://learn.microsoft.com/zh-tw/dotnet/framework/wcf/samples/jsonp>JSONP</a>) 更安全且更有彈性。</li></ul><h2 id=何謂相同原始來源>何謂相同原始來源<a hidden class=anchor aria-hidden=true href=#何謂相同原始來源>#</a></h2><ul><li>如果兩個 URL 具有相同的配置、主機和連接埠，則其原始來源相同 (<a href=https://tools.ietf.org/html/rfc6454>RFC 6454</a>)。<ul><li>這兩個 URL 具有相同的原始來源：<ul><li><code>https://example.com/foo.html</code></li><li><code>https://example.com/bar.html</code></li></ul></li><li>這些 URL 的原始來源與前兩個 URL 不同：<ul><li><code>https://example.net：不同的</code>網域</li><li><code>https://www.example.com/foo.html</code>：不同的子網域</li><li><code>http://example.com/foo.html</code>：不同的配置</li><li><code>https://example.com:9000/foo.html</code>：不同的連接埠</li></ul></li></ul></li></ul><h2 id=如何啟動-cors>如何啟動 CORS<a hidden class=anchor aria-hidden=true href=#如何啟動-cors>#</a></h2><p>有三種方式可以啟用 CORS：</p><ul><li>在中介軟體中，使用<strong>具名原則</strong>或<strong>預設原則</strong>。</li><li>使用<strong>端點路由</strong>。</li><li>使用 <strong>[EnableCors]</strong> 屬性。
搭配具名原則使用 [EnableCors] 屬性能夠以最精細的程度來控制對於支援 CORS 之端點的限制。</li></ul><style type=text/css>.notice{--root-color:#444;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#c33;--warning-content:#fee;--info-title:#fb7;--info-content:#fec;--note-title:#6be;--note-content:#e7f2fa;--tip-title:#5a5;--tip-content:#efe}@media(prefers-color-scheme:dark){.notice{--root-color:#ddd;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#800;--warning-content:#400;--info-title:#a50;--info-content:#420;--note-title:#069;--note-content:#023;--tip-title:#363;--tip-content:#121}}body.dark .notice{--root-color:#ddd;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#800;--warning-content:#400;--info-title:#a50;--info-content:#420;--note-title:#069;--note-content:#023;--tip-title:#363;--tip-content:#121}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--root-color);background:var(--root-background)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background)}.notice.warning .notice-title{background:var(--warning-title)}.notice.warning{background:var(--warning-content)}.notice.info .notice-title{background:var(--info-title)}.notice.info{background:var(--info-content)}.notice.note .notice-title{background:var(--note-title)}.notice.note{background:var(--note-content)}.notice.tip .notice-title{background:var(--tip-title)}.notice.tip{background:var(--tip-content)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div><svg width="0" height="0" display="none"><symbol id="tip-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379.0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628.0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628.0l-22.627 22.627c-6.248 6.248-6.248 16.379.0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"/></symbol><symbol id="note-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405.0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346 7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373.0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884.0-12.356 5.78-11.981 12.654z"/></symbol><symbol id="warning-notice" viewBox="0 0 576 512" preserveAspectRatio="xMidYMid meet"><path d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937.0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154.0l239.94 416.028zM288 354c-25.405.0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346 7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373.0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884.0-12.356 5.78-11.981 12.654z"/></symbol><symbol id="info-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196.0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627.0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627.0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627.0 12 5.373 12 12v1e2h12c6.627.0 12 5.373 12 12v24z"/></symbol></svg></div><div class="notice warning"><p class="first notice-title"><span class="icon-notice baseline"><svg><use href="#warning-notice"/></svg></span></p><p>必須以正確的順序呼叫 <strong>UseCors</strong>。例如，在使用 <strong>UseResponseCaching</strong> 時，必須先呼叫 <strong>UseCors</strong>，再呼叫 <strong>UseResponseCaching</strong>。</p></div><h3 id=具有具名原則和中介軟體的-cors>具有具名原則和中介軟體的 CORS<a hidden class=anchor aria-hidden=true href=#具有具名原則和中介軟體的-cors>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>var</span> MyAllowSpecificOrigins = <span style=color:#e6db74>&#34;_myAllowSpecificOrigins&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> builder = WebApplication.CreateBuilder(args);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>builder.Services.AddCors(options =&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    options.AddPolicy(name: MyAllowSpecificOrigins,
</span></span><span style=display:flex><span>                      policy  =&gt;
</span></span><span style=display:flex><span>                      {
</span></span><span style=display:flex><span>                          policy.WithOrigins(<span style=color:#e6db74>&#34;http://example.com&#34;</span>, <span style=color:#e6db74>&#34;http://www.contoso.com&#34;</span>);
</span></span><span style=display:flex><span>                          <span style=color:#75715e>// policy.WithOrigins(&#34;http://example.com&#34;, &#34;http://www.contoso.com&#34;)</span>
</span></span><span style=display:flex><span>                          <span style=color:#75715e>//       .AllowAnyHeader()</span>
</span></span><span style=display:flex><span>                          <span style=color:#75715e>//       .AllowAnyMethod();       ### policyBuilder 可以鏈結 ###</span>
</span></span><span style=display:flex><span>                      });
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span><span style=color:#75715e>// services.AddResponseCaching();</span>
</span></span><span style=display:flex><span>builder.Services.AddControllers();
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> app = builder.Build();
</span></span><span style=display:flex><span>app.UseHttpsRedirection();
</span></span><span style=display:flex><span>app.UseStaticFiles();
</span></span><span style=display:flex><span>app.UseRouting();
</span></span><span style=display:flex><span>app.UseCors(MyAllowSpecificOrigins);
</span></span><span style=display:flex><span>app.UseAuthorization();
</span></span><span style=display:flex><span>app.MapControllers();
</span></span><span style=display:flex><span>app.Run();
</span></span></code></pre></div><p>上述 程式碼：</p><ul><li>將原則名稱設定為 <code>_myAllowSpecificOrigins</code>。原則名稱可以為任意值。</li><li>呼叫 <strong>UseCors</strong> 擴充方法，並指定 <code>_myAllowSpecificOrigins</code> CORS 原則。<code>UseCors</code> 會新增 CORS 中介軟體。對 <code>UseCors</code> 的呼叫必須放在 <code>UseRouting</code> 之後、<code>UseAuthorization</code> 之前。</li><li>使用 <strong>Lambda 運算式</strong>呼叫 <code>AddCors</code>。 Lambda 會採用 <code>CorsPolicyBuilder</code> 物件。本文稍後會說明<strong>組態選項</strong>，例如：<code>WithOrigins</code>。</li><li>為所有控制器端點啟用 <code>_myAllowSpecificOrigins</code> CORS 原則。</li><li>使<strong>回應快取中介軟體</strong>時，請先呼叫 <code>UseCors</code>，再呼叫 <code>UseResponseCaching</code>。</li></ul><p>使用端點路由時，CORS 中介軟體必須設定為在呼叫 <code>UseRouting</code> 和 <code>UseEndpoints</code> 之間執行。<br><code>AddCors</code> 方法呼叫會將 CORS 服務新增至應用程式的服務容器：</p><div class="notice warning"><p class="first notice-title"><span class="icon-notice baseline"><svg><use href="#warning-notice"/></svg></span></p><p>注意：指定的 URL 不得包含尾端斜線 (/)。 如果 URL 以 / 終止，則比較會傳回 false，而且不會傳回任何標頭。</p></div><ul><li>UseCors 和 UseStaticFiles 順序
一般而言，會先呼叫 <code>UseStaticFiles</code>，再呼叫 <code>UseCors。</code> 使用 JavaScript 來擷取跨網站靜態檔案的應用程式必須先呼叫 <code>UseCors</code>，再呼叫 <code>UseStaticFiles</code>。</li></ul><hr><h3 id=具有預設原則和中介軟體的-cors>具有預設原則和中介軟體的 CORS<a hidden class=anchor aria-hidden=true href=#具有預設原則和中介軟體的-cors>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>var</span> builder = WebApplication.CreateBuilder(args);
</span></span><span style=display:flex><span>builder.Services.AddCors(options =&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    options.AddDefaultPolicy(
</span></span><span style=display:flex><span>        policy =&gt;
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            policy.WithOrigins(<span style=color:#e6db74>&#34;http://example.com&#34;</span>, <span style=color:#e6db74>&#34;http://www.contoso.com&#34;</span>);
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>builder.Services.AddControllers();
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> app = builder.Build();
</span></span><span style=display:flex><span>app.UseHttpsRedirection();
</span></span><span style=display:flex><span>app.UseStaticFiles();
</span></span><span style=display:flex><span>app.UseRouting();
</span></span><span style=display:flex><span>app.UseCors();
</span></span><span style=display:flex><span>app.UseAuthorization();
</span></span><span style=display:flex><span>app.MapControllers();
</span></span><span style=display:flex><span>app.Run();
</span></span></code></pre></div><p>上述程式碼會將預設 CORS 原則套用至所有控制器端點。</p><hr><h3 id=使用端點路由啟用-cors>使用端點路由啟用 CORS<a hidden class=anchor aria-hidden=true href=#使用端點路由啟用-cors>#</a></h3><p>使用端點路由時，可以使用一組 <code>RequiredCors</code> 擴充方法，逐個端點啟用 CORS：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>var</span> MyAllowSpecificOrigins = <span style=color:#e6db74>&#34;_myAllowSpecificOrigins&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> builder = WebApplication.CreateBuilder(args);
</span></span><span style=display:flex><span>builder.Services.AddCors(options =&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    options.AddPolicy(name: MyAllowSpecificOrigins,
</span></span><span style=display:flex><span>                      policy =&gt;
</span></span><span style=display:flex><span>                      {
</span></span><span style=display:flex><span>                          policy.WithOrigins(<span style=color:#e6db74>&#34;http://example.com&#34;</span>, <span style=color:#e6db74>&#34;http://www.contoso.com&#34;</span>);
</span></span><span style=display:flex><span>                      });
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>builder.Services.AddControllers();
</span></span><span style=display:flex><span>builder.Services.AddRazorPages();
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> app = builder.Build();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.UseHttpsRedirection();
</span></span><span style=display:flex><span>app.UseStaticFiles();
</span></span><span style=display:flex><span>app.UseRouting();
</span></span><span style=display:flex><span>app.UseCors();
</span></span><span style=display:flex><span>app.UseAuthorization();
</span></span><span style=display:flex><span>app.UseEndpoints(endpoints =&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    endpoints.MapGet(<span style=color:#e6db74>&#34;/echo&#34;</span>,
</span></span><span style=display:flex><span>        context =&gt; context.Response.WriteAsync(<span style=color:#e6db74>&#34;echo&#34;</span>))
</span></span><span style=display:flex><span>        .RequireCors(MyAllowSpecificOrigins);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    endpoints.MapControllers()
</span></span><span style=display:flex><span>             .RequireCors(MyAllowSpecificOrigins);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    endpoints.MapGet(<span style=color:#e6db74>&#34;/echo2&#34;</span>,
</span></span><span style=display:flex><span>        context =&gt; context.Response.WriteAsync(<span style=color:#e6db74>&#34;echo2&#34;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    endpoints.MapRazorPages();
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>app.Run();
</span></span></code></pre></div><p>在上述程式碼中：</p><ul><li><code>app.UseCors</code> 會啟用 CORS 中介軟體。 因為尚未設定預設原則，因此單獨的 <code>app.UseCors()</code> 不會啟用 CORS。</li><li><code>/echo</code> 和控制器端點允許使用指定的原則進行跨原始來源要求。</li><li><code>/echo2</code> 和 Razor Pages 端點不允許跨原始來源要求，因為未指定預設原則。
如果 CORS 是由端點路由透過 <code>RequireCors</code> 所啟用的，則 <code>[DisableCors]</code> 屬性無法停用 CORS。</li></ul><hr><h3 id=使用屬性啟用-cors>使用屬性啟用 CORS<a hidden class=anchor aria-hidden=true href=#使用屬性啟用-cors>#</a></h3><p>使用<code>[EnableCors]</code>屬性啟用 CORS，並將具名原則套用至只需要 CORS 的端點，這樣才能提供最精細的控制。
<code>[EnableCors]</code> 屬性提供全域套用 CORS 的替代方案。<code>[EnableCors]</code> 屬性會啟用所選端點的 CORS，而不是所有端點：</p><ul><li><code>[EnableCors]</code> 指定預設原則。</li><li><code>[EnableCors("{Policy String}")]</code> 指定具名原則。</li></ul><p>[EnableCors] 屬性可以套用至：</p><ul><li>Razor Page PageModel</li><li>控制器</li><li>控制器動作方法
透過 <code>[EnableCors]</code> 屬性，可以將不同的原則套用至控制器、頁面模型或動作方法。 當 <code>[EnableCors]</code> 屬性套用至控制器、頁面模型或動作方法，並在中介軟體中啟用 CORS 時，兩個原則都會被套用。 不建議進行原則合併。 使用 <code>[EnableCors]</code> 屬性或中介軟體，而不是在同一個應用程式中。</li></ul><p>下列程式碼會將不同的原則套用至每個方法：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#a6e22e>[Route(&#34;api/[controller]</span><span style=color:#e6db74>&#34;)]
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#a6e22e>[ApiController]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WidgetController</span> : ControllerBase
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>// GET api/values</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>    [EnableCors(&#34;AnotherPolicy&#34;)]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>    [HttpGet]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> ActionResult&lt;IEnumerable&lt;<span style=color:#66d9ef>string</span>&gt;&gt; Get()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>string</span>[] { <span style=color:#e6db74>&#34;green widget&#34;</span>, <span style=color:#e6db74>&#34;red widget&#34;</span> };
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// GET api/values/5</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>    [EnableCors(&#34;Policy1&#34;)]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>    [HttpGet(&#34;{id}&#34;)]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> ActionResult&lt;<span style=color:#66d9ef>string</span>&gt; Get(<span style=color:#66d9ef>int</span> id)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> id <span style=color:#66d9ef>switch</span>
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>1</span> =&gt; <span style=color:#e6db74>&#34;green widget&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#ae81ff>2</span> =&gt; <span style=color:#e6db74>&#34;red widget&#34;</span>,
</span></span><span style=display:flex><span>            _ =&gt; NotFound(),
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>下列程式碼會建立兩個 CORS 原則：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>var</span> builder = WebApplication.CreateBuilder(args);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>builder.Services.AddCors(options =&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    options.AddPolicy(<span style=color:#e6db74>&#34;Policy1&#34;</span>,
</span></span><span style=display:flex><span>        policy =&gt;
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            policy.WithOrigins(<span style=color:#e6db74>&#34;http://example.com&#34;</span>,
</span></span><span style=display:flex><span>                                <span style=color:#e6db74>&#34;http://www.contoso.com&#34;</span>);
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    options.AddPolicy(<span style=color:#e6db74>&#34;AnotherPolicy&#34;</span>,
</span></span><span style=display:flex><span>        policy =&gt;
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            policy.WithOrigins(<span style=color:#e6db74>&#34;http://www.contoso.com&#34;</span>)
</span></span><span style=display:flex><span>                                .AllowAnyHeader()
</span></span><span style=display:flex><span>                                .AllowAnyMethod();
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>builder.Services.AddControllers();
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> app = builder.Build();
</span></span><span style=display:flex><span>app.UseHttpsRedirection();
</span></span><span style=display:flex><span>app.UseRouting();
</span></span><span style=display:flex><span>app.UseCors();
</span></span><span style=display:flex><span>app.UseAuthorization();
</span></span><span style=display:flex><span>app.MapControllers();
</span></span><span style=display:flex><span>app.Run();
</span></span></code></pre></div><p>如需對 CORS 要求限制進行最精細的控制：</p><p>搭配具名原則使用 <code>[EnableCors("MyPolicy")]</code>。</p><ul><li>不要定義預設原則。</li><li>不要使用端點路由。</li><li>下一節中的程式碼符合上述清單。</li></ul><h2 id=停用-cors>停用 CORS<a hidden class=anchor aria-hidden=true href=#停用-cors>#</a></h2><p>如果 CORS 是由端點路由所啟用的，則 <code>[DisableCors]</code> 屬性無法停用 CORS。</p><p>下列程式碼會定義 CORS 原則 <code>"MyPolicy"</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>var</span> MyAllowSpecificOrigins = <span style=color:#e6db74>&#34;_myAllowSpecificOrigins&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> builder = WebApplication.CreateBuilder(args);
</span></span><span style=display:flex><span>builder.Services.AddCors(options =&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    options.AddPolicy(name: <span style=color:#e6db74>&#34;MyPolicy&#34;</span>,
</span></span><span style=display:flex><span>        policy =&gt;
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            policy.WithOrigins(<span style=color:#e6db74>&#34;http://example.com&#34;</span>,
</span></span><span style=display:flex><span>                                <span style=color:#e6db74>&#34;http://www.contoso.com&#34;</span>)
</span></span><span style=display:flex><span>                    .WithMethods(<span style=color:#e6db74>&#34;PUT&#34;</span>, <span style=color:#e6db74>&#34;DELETE&#34;</span>, <span style=color:#e6db74>&#34;GET&#34;</span>);
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>builder.Services.AddControllers();
</span></span><span style=display:flex><span>builder.Services.AddRazorPages();
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> app = builder.Build();
</span></span><span style=display:flex><span>app.UseHttpsRedirection();
</span></span><span style=display:flex><span>app.UseStaticFiles();
</span></span><span style=display:flex><span>app.UseRouting();
</span></span><span style=display:flex><span>app.UseCors();
</span></span><span style=display:flex><span>app.UseAuthorization();
</span></span><span style=display:flex><span>app.UseEndpoints(endpoints =&gt; {
</span></span><span style=display:flex><span>    endpoints.MapControllers();
</span></span><span style=display:flex><span>    endpoints.MapRazorPages();
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>app.Run();
</span></span></code></pre></div><p>下列程式碼會停用 <code>GetValues2</code> 動作的 CORS：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#a6e22e>[EnableCors(&#34;MyPolicy&#34;)]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>[Route(&#34;api/[controller]</span><span style=color:#e6db74>&#34;)]
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#a6e22e>[ApiController]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ValuesController</span> : ControllerBase
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>// GET api/values</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>    [HttpGet]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> IActionResult Get() =&gt;
</span></span><span style=display:flex><span>        ControllerContext.MyDisplayRouteInfo();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// GET api/values/5</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>    [HttpGet(&#34;{id}&#34;)]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> IActionResult Get(<span style=color:#66d9ef>int</span> id) =&gt;
</span></span><span style=display:flex><span>        ControllerContext.MyDisplayRouteInfo(id);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// PUT api/values/5</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>    [HttpPut(&#34;{id}&#34;)]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> IActionResult Put(<span style=color:#66d9ef>int</span> id) =&gt;
</span></span><span style=display:flex><span>        ControllerContext.MyDisplayRouteInfo(id);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// GET: api/values/GetValues2</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>    [DisableCors]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>    [HttpGet(&#34;{action}&#34;)]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> IActionResult GetValues2() =&gt;
</span></span><span style=display:flex><span>        ControllerContext.MyDisplayRouteInfo();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>上述程式碼：</p><ul><li>不會透過端點路由啟用 CORS。</li><li>不會定義預設 CORS 原則。</li><li>使用 [EnableCors(&ldquo;MyPolicy&rdquo;)] 來針對控制器啟用 <code>"MyPolicy"</code> CORS 原則。</li><li>針對 <code>GetValues2</code> 方法停用 CORS。</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://intervalrain.github.io/tags/it/>IT</a></li><li><a href=https://intervalrain.github.io/tags/c%23/>C#</a></li></ul><script type=module>  
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; 
    mermaid.initialize({ startOnLoad: true });  
</script><script>Array.from(document.getElementsByClassName("language-mermaid")).forEach(e=>{e.parentElement.outerHTML=`<div class="mermaid">${e.innerHTML}</div>`})</script><style>.mermaid svg{display:block;margin:auto}</style></footer><script src=https://utteranc.es/client.js repo=Reid00/hugo-blog-talks issue-term=pathname label=Comment theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2025 <a href=https://intervalrain.github.io/>Rain Hu's Workspace</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="複製";function s(){t.innerHTML="已複製！",setTimeout(()=>{t.innerHTML="複製"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>