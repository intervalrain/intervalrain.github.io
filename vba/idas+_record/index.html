<!doctype html><html lang=zh-tw dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[IDAS+] Optimize Summary Table Function | Rain Hu's Workspace</title><meta name=keywords content="VBA,Programming,IDAS+"><meta name=description content="An implementation of dictionary in VBA for searching algorithm"><meta name=author content="Rain Hu"><link rel=canonical href=https://intervalrain.github.io/><meta name=google-site-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.0cefe5a1d95e3d0f0cce057d37c60cd238d1a4af825090f831a18f21671f621d.css integrity="sha256-DO/lodlePQ8MzgV9N8YM0jjRpK+CUJD4MaGPIWcfYh0=" rel="preload stylesheet" as=style><link rel=icon href=https://intervalrain.github.io/images/rain.png><link rel=icon type=image/png sizes=16x16 href=https://intervalrain.github.io/images/rain.png><link rel=icon type=image/png sizes=32x32 href=https://intervalrain.github.io/images/rain.png><link rel=apple-touch-icon href=https://intervalrain.github.io/images/rain.png><link rel=mask-icon href=https://intervalrain.github.io/images/rain.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-tw href=https://intervalrain.github.io/vba/idas+_record/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/katex.min.css integrity=sha384-zTROYFVGOfTw7JV7KUu8udsvW2fx4lWOsCEDqhBreBwlHI4ioVRtmIvEThzJHGET crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/katex.min.js integrity=sha384-GxNFqL3r9uRJQhR+47eDxuPoNE7yLftQM8LcxzgS4HT73tp970WS/wV5p8UzCOmb crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous onload=renderMathInElement(document.body)></script><script src=https://utteranc.es/client.js repo=intervalrain.github.io issue-term=pathname label=Comment theme=github-light crossorigin=anonymous async></script><meta property="og:url" content="https://intervalrain.github.io/vba/idas+_record/"><meta property="og:site_name" content="Rain Hu's Workspace"><meta property="og:title" content="[IDAS+] Optimize Summary Table Function"><meta property="og:description" content="An implementation of dictionary in VBA for searching algorithm"><meta property="og:locale" content="zh-tw"><meta property="og:type" content="article"><meta property="article:section" content="vba"><meta property="article:published_time" content="2022-04-14T00:39:50+08:00"><meta property="article:modified_time" content="2022-04-14T00:39:50+08:00"><meta property="article:tag" content="VBA"><meta property="article:tag" content="Programming"><meta property="article:tag" content="IDAS+"><meta property="og:image" content="https://intervalrain.github.io/images/cover.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://intervalrain.github.io/images/cover.jpg"><meta name=twitter:title content="[IDAS+] Optimize Summary Table Function"><meta name=twitter:description content="An implementation of dictionary in VBA for searching algorithm"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"VBAs","item":"https://intervalrain.github.io/vba/"},{"@type":"ListItem","position":2,"name":"[IDAS+] Optimize Summary Table Function","item":"https://intervalrain.github.io/vba/idas+_record/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[IDAS+] Optimize Summary Table Function","name":"[IDAS\u002b] Optimize Summary Table Function","description":"An implementation of dictionary in VBA for searching algorithm","keywords":["VBA","Programming","IDAS+"],"articleBody":"前言 在做 WAT 量測後的資料處理時，IDAS 老舊的 VBA macro 執行時間實在過於久，且佔用大量的記憶體，於是就下了一個命題，想減少產生報表的時間。 想法 通常量測多片 wafer 的狀況下，不同 wafer 的排列順序是一致的，如果可以加入 Java 中 HashMap 的資料結構來處理 VBA 中 Lookup()，便可大幅減少 summary table 時，對 rawdata 做搜尋的時間。 令時間複雜度從\\(O(n)\\)進步到\\(O(1)\\)。 做法 產生 Dictionary 物件 由於 VBA 預設並沒有 Dictionary 的物，所以需要用 CreateObject(\"Scritping.Dictionary\") 的程式碼，引入 Dictionary。 其 Dictionary 物件的 method 可參考 Microsoft 的文件：點此 在此先預先定義一個 function setDict() 可以對初始化 Dictionary。 接著宣告兩個 Dictionary 物件來存取 spec 和 data 工作頁的列數(\brow)。 Dim SpecDict As Object ' Claim a dict to store spec rows in worksheet SPEC. Dim DataDict As Object ' Claim a dict to store rawdata rows in worksheet Data. Set SpecDict = CreateObject(\"Scripting.Dictionary\") Set DataDict = CreateObject(\"Scripting.Dictionary\") Call setDict(\"SPEC\", 3, SpecDict, Worksheets(\"SPEC\").UsedRange, True) Call setDict(\"Data\", 2, DataDict, Range(Worksheets(\"Data\").Names(1)), True) 實作 setDict() 函數 利用 HashTable 的概念對不同的 parameter 列數先做一次記錄，因為只需一次迴圈，故時間複雜度是 \\(O(n)\\)，其中 n = SPEC 的列數 或是 量測的 parameter 數。 在此設計了五個 arguments，方便在未來如果還有使用到 Dictionary 的需求時，可以方便使用。 sheetName 字串，需要作儲存的工作頁(worksheet)。 Target 要儲存的列數(row)或欄數(column)。 Dict 要存放的 Dictionary 物件。 mRange 要做儲存的資料範圍，若表頭並是在第一列或第一欄時可指定。 若表頭是第一列或第一欄時，可直接代入 Worksheets(\"工作頁名稱\").UsedRange byRows 看要儲存的對象是列(row)或是欄(column)，預設是以列來搜尋。 Public Function setDict(ByVal sheetName As String, ByVal Target As Integer, ByRef Dict As Object, ByVal mRange As Range, Optional ByVal byRows As Boolean = True) Dim nowSheet As Worksheet If Not IsExistSheet(sheetName) Then Exit Function Set nowSheet = Worksheets(sheetName) Dim i As Long Dim n As Long On Error Resume Next If byRows = True Then For i = 1 To mRange.Rows.Count If Not Trim(mRange.Cells(i, Target).Value) = \"\" Then Dict.Add mRange.Cells(i, Target).Value, i End If Next i Else For i = 1 To mRange.Columns.Count If Not Trim(mRange.Cells(Target, i).Value) = \"\" Then Dict.Add mRange.Cells(Target, i).Value, i End If Next i End If End Function 對 getSPECByPara() 做重製 將 parameter or SPEC 做 hashing 的處理後，可以用 Dictionary 物件來查值，時間複雜度為 \\(O(1)\\)。 在此不對原本的設計做更動，只做單純的 implement。 nowPara 要搜尋的 parameter 字串。 n 要搜尋的欄數(column)，specColumn是原作者預設的 enum，存放工作頁 SPEC 的每一欄的表頭。 \bsheetName 要搜尋的工作頁，預設為 SPECTEMP，是按完 initial，從 SPEC 工作頁複製出來的隱藏工作頁。 Public Function getSPECByPara(ByVal nowPara As String, ByVal n As specColumn, Optional sheetName As String = \"SPECTEMP\") Dim reValue Dim nowRange As Range Dim TargetSheet As Worksheet If Left(nowPara, 1) = \"'\" Then nowPara = Mid(nowPara, 2) Set TargetSheet = Worksheets(sheetName) Set nowRange = TargetSheet.UsedRange On Error Resume Next reValue = TargetSheet.Cells(SpecDict(nowPara), n) If Not IsEmpty(reValue) Then If Trim(reValue) = \"\" Then Set reValue = Nothing End If getSPECByPara = reValue End Function 對 getRangeByPara() 做重製 將 parameter or SPEC 做 hashing 的處理後，可以用 Dictionary 物件來查值，時間複雜度為 \\(O(1)\\)。 Public Function getRangeByPara(nowWafer As String, nowPara As String, Optional dieNum As Integer = 0) Dim nowRow As Long Dim nowRange As Range Set nowRange = Worksheets(\"Data\").Range(\"wafer_\" \u0026 nowWafer) Set getRangeByPara = Nothing If DataDict.Exists(nowPara) Then nowRow = DataDict(nowPara) Set getRangeByPara = nowRange.Range(N2L(4) \u0026 CStr(nowRow) \u0026 \":\" \u0026 N2L(dieNum + 3) \u0026 CStr(nowRow)) End If End Function 解析 優點：較快的執行速度。經測試可以將 2~3 分鐘的執行時間縮短到 30 秒內。 缺點：若修改 rawdata，會發生錯誤。但若針對每一片 wafer 都做 setDict()的話，會浪費太多 memory。 ","wordCount":"429","inLanguage":"zh-tw","image":"https://intervalrain.github.io/images/cover.jpg","datePublished":"2022-04-14T00:39:50+08:00","dateModified":"2022-04-14T00:39:50+08:00","author":{"@type":"Person","name":"Rain Hu"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://intervalrain.github.io/vba/idas+_record/"},"publisher":{"@type":"Organization","name":"Rain Hu's Workspace","logo":{"@type":"ImageObject","url":"https://intervalrain.github.io/images/rain.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://intervalrain.github.io/ accesskey=h title="Rain Hu's Workspace (Alt + H)"><img src=https://intervalrain.github.io/images/rain.png alt aria-label=logo height=35>Rain Hu's Workspace</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://intervalrain.github.io/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://intervalrain.github.io/aboutme title="About me"><span>About me</span></a></li><li><a href=https://intervalrain.github.io/archives title=Archives><span>Archives</span></a></li><li><a href=https://intervalrain.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://intervalrain.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://intervalrain.github.io/csharp/csharp title=C#><span>C#</span></a></li><li><a href=https://intervalrain.github.io/csindex title=CS><span>CS</span></a></li><li><a href=https://intervalrain.github.io/leetcode title=LeetCode><span>LeetCode</span></a></li><li><a href=https://intervalrain.github.io/ai title=AI><span>AI</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://intervalrain.github.io/>首頁</a>&nbsp;»&nbsp;<a href=https://intervalrain.github.io/vba/>VBAs</a></div><h1 class="post-title entry-hint-parent">[IDAS+] Optimize Summary Table Function</h1><div class=post-description>An implementation of dictionary in VBA for searching algorithm</div><div class=post-meta><span title='2022-04-14 00:39:50 +0800 +0800'>April 14, 2022</span>&nbsp;·&nbsp;3 分鐘&nbsp;·&nbsp;Rain Hu&nbsp;|&nbsp;<a href=https://github.com/intervalrain/intervalrain.github.io/tree/main/content//VBA/IDAS+_record.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=eager src=https://intervalrain.github.io/images/cover.jpg alt="Oh! You closed up the window, so you cannot see raining"></figure><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目錄</span></summary><div class=inner><ul><li><a href=#%e5%89%8d%e8%a8%80 aria-label=前言>前言</a></li><li><a href=#%e6%83%b3%e6%b3%95 aria-label=想法>想法</a></li><li><a href=#%e5%81%9a%e6%b3%95 aria-label=做法>做法</a><ul><li><a href=#%e7%94%a2%e7%94%9f-dictionary-%e7%89%a9%e4%bb%b6 aria-label="產生 Dictionary 物件">產生 Dictionary 物件</a></li><li><a href=#%e5%af%a6%e4%bd%9c-setdict-%e5%87%bd%e6%95%b8 aria-label="實作 setDict() 函數">實作 setDict() 函數</a></li><li><a href=#%e5%b0%8d-getspecbypara-%e5%81%9a%e9%87%8d%e8%a3%bd aria-label="對 getSPECByPara() 做重製">對 getSPECByPara() 做重製</a></li><li><a href=#%e5%b0%8d-getrangebypara-%e5%81%9a%e9%87%8d%e8%a3%bd aria-label="對 getRangeByPara() 做重製">對 getRangeByPara() 做重製</a></li></ul></li><li><a href=#%e8%a7%a3%e6%9e%90 aria-label=解析>解析</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h1 id=前言>前言<a hidden class=anchor aria-hidden=true href=#前言>#</a></h1><ul><li>在做 WAT 量測後的資料處理時，IDAS 老舊的 VBA macro 執行時間實在過於久，且佔用大量的記憶體，於是就下了一個命題，想減少產生報表的時間。</li></ul><h1 id=想法>想法<a hidden class=anchor aria-hidden=true href=#想法>#</a></h1><ul><li>通常量測多片 wafer 的狀況下，不同 wafer 的排列順序是一致的，如果可以加入 Java 中 <code>HashMap</code> 的資料結構來處理 VBA 中 <code>Lookup()</code>，便可大幅減少 summary table 時，對 rawdata 做搜尋的時間。</li><li>令時間複雜度從\(O(n)\)進步到\(O(1)\)。</li></ul><h1 id=做法>做法<a hidden class=anchor aria-hidden=true href=#做法>#</a></h1><h2 id=產生-dictionary-物件>產生 Dictionary 物件<a hidden class=anchor aria-hidden=true href=#產生-dictionary-物件>#</a></h2><ul><li>由於 VBA 預設並沒有 Dictionary 的物，所以需要用 <code>CreateObject("Scritping.Dictionary")</code> 的程式碼，引入 Dictionary。</li><li>其 Dictionary 物件的 method 可參考 Microsoft 的文件：<a href=https://docs.microsoft.com/zh-tw/office/vba/language/reference/user-interface-help/dictionary-object>點此</a></li><li>在此先預先定義一個 function <code>setDict()</code> 可以對初始化 Dictionary。</li><li>接著宣告兩個 Dictionary 物件來存取 spec 和 data 工作頁的列數(row)。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-VB.NET data-lang=VB.NET><span style=display:flex><span><span style=color:#66d9ef>Dim</span> SpecDict <span style=color:#f92672>As</span> <span style=color:#66d9ef>Object</span> <span style=color:#75715e>&#39; Claim a dict to store spec rows in worksheet SPEC.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>Dim</span> DataDict <span style=color:#f92672>As</span> <span style=color:#66d9ef>Object</span> <span style=color:#75715e>&#39; Claim a dict to store rawdata rows in worksheet Data.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>Set</span> SpecDict <span style=color:#f92672>=</span> CreateObject(<span style=color:#e6db74>&#34;Scripting.Dictionary&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>Set</span> DataDict <span style=color:#f92672>=</span> CreateObject(<span style=color:#e6db74>&#34;Scripting.Dictionary&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>Call</span> setDict(<span style=color:#e6db74>&#34;SPEC&#34;</span>, 3, SpecDict, Worksheets(<span style=color:#e6db74>&#34;SPEC&#34;</span>).UsedRange, <span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>Call</span> setDict(<span style=color:#e6db74>&#34;Data&#34;</span>, 2, DataDict, Range(Worksheets(<span style=color:#e6db74>&#34;Data&#34;</span>).Names(1)), <span style=color:#66d9ef>True</span>)
</span></span></code></pre></div><h2 id=實作-setdict-函數>實作 setDict() 函數<a hidden class=anchor aria-hidden=true href=#實作-setdict-函數>#</a></h2><ul><li>利用 HashTable 的概念對不同的 parameter 列數先做一次記錄，因為只需一次迴圈，故時間複雜度是 \(O(n)\)，其中 n = SPEC 的列數 或是 量測的 parameter 數。</li><li>在此設計了五個 arguments，方便在未來如果還有使用到 Dictionary 的需求時，可以方便使用。<ul><li><code>sheetName</code> 字串，需要作儲存的工作頁(worksheet)。</li><li><code>Target</code> 要儲存的列數(row)或欄數(column)。</li><li><code>Dict</code> 要存放的 Dictionary 物件。</li><li><code>mRange</code> 要做儲存的資料範圍，若表頭並是在第一列或第一欄時可指定。<ul><li>若表頭是第一列或第一欄時，可直接代入 <code>Worksheets("工作頁名稱").UsedRange</code></li></ul></li><li><code>byRows</code> 看要儲存的對象是列(row)或是欄(column)，預設是以列來搜尋。</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-VB.NET data-lang=VB.NET><span style=display:flex><span><span style=color:#66d9ef>Public</span> <span style=color:#66d9ef>Function</span> <span style=color:#a6e22e>setDict</span>(<span style=color:#66d9ef>ByVal</span> sheetName <span style=color:#f92672>As</span> <span style=color:#66d9ef>String</span>, <span style=color:#66d9ef>ByVal</span> Target <span style=color:#f92672>As</span> <span style=color:#66d9ef>Integer</span>, <span style=color:#66d9ef>ByRef</span> Dict <span style=color:#f92672>As</span> <span style=color:#66d9ef>Object</span>, <span style=color:#66d9ef>ByVal</span> mRange <span style=color:#f92672>As</span> Range, <span style=color:#66d9ef>Optional</span> <span style=color:#66d9ef>ByVal</span> byRows <span style=color:#f92672>As</span> <span style=color:#66d9ef>Boolean</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>Dim</span> nowSheet <span style=color:#f92672>As</span> Worksheet
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>If</span> <span style=color:#66d9ef>Not</span> IsExistSheet(sheetName) <span style=color:#66d9ef>Then</span> <span style=color:#66d9ef>Exit</span> <span style=color:#66d9ef>Function</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Set</span> nowSheet <span style=color:#f92672>=</span> Worksheets(sheetName)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>Dim</span> i <span style=color:#f92672>As</span> <span style=color:#66d9ef>Long</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>Dim</span> n <span style=color:#f92672>As</span> <span style=color:#66d9ef>Long</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>On</span> <span style=color:#66d9ef>Error</span> <span style=color:#66d9ef>Resume</span> <span style=color:#66d9ef>Next</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>If</span> byRows <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span> <span style=color:#66d9ef>Then</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>For</span> i <span style=color:#f92672>=</span> 1 <span style=color:#66d9ef>To</span> mRange.Rows.Count
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>If</span> <span style=color:#66d9ef>Not</span> Trim(mRange.Cells(i, Target).Value) <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span> <span style=color:#66d9ef>Then</span>
</span></span><span style=display:flex><span>                Dict.Add mRange.Cells(i, Target).Value, i
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>End</span> <span style=color:#66d9ef>If</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>Next</span> i
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>Else</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>For</span> i <span style=color:#f92672>=</span> 1 <span style=color:#66d9ef>To</span> mRange.Columns.Count
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>If</span> <span style=color:#66d9ef>Not</span> Trim(mRange.Cells(Target, i).Value) <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span> <span style=color:#66d9ef>Then</span>
</span></span><span style=display:flex><span>                Dict.Add mRange.Cells(Target, i).Value, i
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>End</span> <span style=color:#66d9ef>If</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>Next</span> i
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>End</span> <span style=color:#66d9ef>If</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#66d9ef>End</span> <span style=color:#66d9ef>Function</span>
</span></span></code></pre></div><h2 id=對-getspecbypara-做重製>對 getSPECByPara() 做重製<a hidden class=anchor aria-hidden=true href=#對-getspecbypara-做重製>#</a></h2><ul><li>將 parameter or SPEC 做 hashing 的處理後，可以用 Dictionary 物件來查值，時間複雜度為 \(O(1)\)。</li><li>在此不對原本的設計做更動，只做單純的 implement。<ul><li><code>nowPara</code> 要搜尋的 parameter 字串。</li><li><code>n</code> 要搜尋的欄數(column)，specColumn是原作者預設的 enum，存放工作頁 SPEC 的每一欄的表頭。</li><li><code>sheetName</code> 要搜尋的工作頁，預設為 SPECTEMP，是按完 initial，從 SPEC 工作頁複製出來的隱藏工作頁。</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-VB.NET data-lang=VB.NET><span style=display:flex><span><span style=color:#66d9ef>Public</span> <span style=color:#66d9ef>Function</span> <span style=color:#a6e22e>getSPECByPara</span>(<span style=color:#66d9ef>ByVal</span> nowPara <span style=color:#f92672>As</span> <span style=color:#66d9ef>String</span>, <span style=color:#66d9ef>ByVal</span> n <span style=color:#f92672>As</span> specColumn, <span style=color:#66d9ef>Optional</span> sheetName <span style=color:#f92672>As</span> <span style=color:#66d9ef>String</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;SPECTEMP&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>Dim</span> reValue
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>Dim</span> nowRange <span style=color:#f92672>As</span> Range
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>Dim</span> TargetSheet <span style=color:#f92672>As</span> Worksheet
</span></span><span style=display:flex><span>   
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>If</span> Left(nowPara, 1) <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#39;&#34;</span> <span style=color:#66d9ef>Then</span> nowPara <span style=color:#f92672>=</span> Mid(nowPara, 2)
</span></span><span style=display:flex><span>   
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>Set</span> TargetSheet <span style=color:#f92672>=</span> Worksheets(sheetName)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>Set</span> nowRange <span style=color:#f92672>=</span> TargetSheet.UsedRange
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>On</span> <span style=color:#66d9ef>Error</span> <span style=color:#66d9ef>Resume</span> <span style=color:#66d9ef>Next</span>
</span></span><span style=display:flex><span>    reValue <span style=color:#f92672>=</span> TargetSheet.Cells(SpecDict(nowPara), n)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>If</span> <span style=color:#66d9ef>Not</span> IsEmpty(reValue) <span style=color:#66d9ef>Then</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>If</span> Trim(reValue) <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span> <span style=color:#66d9ef>Then</span> <span style=color:#66d9ef>Set</span> reValue <span style=color:#f92672>=</span> <span style=color:#66d9ef>Nothing</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>End</span> <span style=color:#66d9ef>If</span>
</span></span><span style=display:flex><span>    getSPECByPara <span style=color:#f92672>=</span> reValue
</span></span><span style=display:flex><span><span style=color:#66d9ef>End</span> <span style=color:#66d9ef>Function</span>
</span></span></code></pre></div><h2 id=對-getrangebypara-做重製>對 getRangeByPara() 做重製<a hidden class=anchor aria-hidden=true href=#對-getrangebypara-做重製>#</a></h2><ul><li>將 parameter or SPEC 做 hashing 的處理後，可以用 Dictionary 物件來查值，時間複雜度為 \(O(1)\)。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-VB.NET data-lang=VB.NET><span style=display:flex><span><span style=color:#66d9ef>Public</span> <span style=color:#66d9ef>Function</span> <span style=color:#a6e22e>getRangeByPara</span>(nowWafer <span style=color:#f92672>As</span> <span style=color:#66d9ef>String</span>, nowPara <span style=color:#f92672>As</span> <span style=color:#66d9ef>String</span>, <span style=color:#66d9ef>Optional</span> dieNum <span style=color:#f92672>As</span> <span style=color:#66d9ef>Integer</span> <span style=color:#f92672>=</span> 0)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>Dim</span> nowRow <span style=color:#f92672>As</span> <span style=color:#66d9ef>Long</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>Dim</span> nowRange <span style=color:#f92672>As</span> Range
</span></span><span style=display:flex><span>   
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>Set</span> nowRange <span style=color:#f92672>=</span> Worksheets(<span style=color:#e6db74>&#34;Data&#34;</span>).Range(<span style=color:#e6db74>&#34;wafer_&#34;</span> <span style=color:#f92672>&amp;</span> nowWafer)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>Set</span> getRangeByPara <span style=color:#f92672>=</span> <span style=color:#66d9ef>Nothing</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>If</span> DataDict.Exists(nowPara) <span style=color:#66d9ef>Then</span>
</span></span><span style=display:flex><span>        nowRow <span style=color:#f92672>=</span> DataDict(nowPara)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>Set</span> getRangeByPara <span style=color:#f92672>=</span> nowRange.Range(N2L(4) <span style=color:#f92672>&amp;</span> <span style=color:#66d9ef>CStr</span>(nowRow) <span style=color:#f92672>&amp;</span> <span style=color:#e6db74>&#34;:&#34;</span> <span style=color:#f92672>&amp;</span> N2L(dieNum <span style=color:#f92672>+</span> 3) <span style=color:#f92672>&amp;</span> <span style=color:#66d9ef>CStr</span>(nowRow))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>End</span> <span style=color:#66d9ef>If</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#66d9ef>End</span> <span style=color:#66d9ef>Function</span>
</span></span></code></pre></div><h1 id=解析>解析<a hidden class=anchor aria-hidden=true href=#解析>#</a></h1><ul><li>優點：較快的執行速度。經測試可以將 2~3 分鐘的執行時間縮短到 30 秒內。</li><li>缺點：若修改 rawdata，會發生錯誤。但若針對每一片 wafer 都做 setDict()的話，會浪費太多 memory。</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://intervalrain.github.io/tags/vba/>VBA</a></li><li><a href=https://intervalrain.github.io/tags/programming/>Programming</a></li><li><a href=https://intervalrain.github.io/tags/idas+/>IDAS+</a></li></ul></footer><script src=https://utteranc.es/client.js repo=Reid00/hugo-blog-talks issue-term=pathname label=Comment theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2025 <a href=https://intervalrain.github.io/>Rain Hu's Workspace</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="複製";function s(){t.innerHTML="已複製！",setTimeout(()=>{t.innerHTML="複製"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>